package com.llmquality.faulty.mapper;

import com.llmquality.faulty.dto.UserRequest;
import com.llmquality.faulty.dto.UserResponse;
import com.llmquality.faulty.entity.User;
import org.mapstruct.*;

/**
 * Mapper interface for converting between database entity {@link User} and User DTOs.
 */
@Mapper(componentModel = "spring")
public interface UserMapper {

    /**
     * Maps a {@link UserRequest} to a {@link User} entity.
     * The {@code id} is ignored since it is generated by the database.
     *
     * @param dto the DTO to map
     * @return the mapped User entity
     */
    @Mapping(target = "id", ignore = true)
    User toEntity(UserRequest dto);

    /**
     * Maps a {@link User} entity to a {@link UserResponse}.
     *
     * @param user the entity to map
     * @return the DTO representing the user without sensitive data
     */
    UserResponse toDTO(User user);


    /**
     * Updates the fields of the given {@link User} entity using values from the provided {@link UserRequest} DTO.
     * <p>
     * The method will map the following fields:
     * <ul>
     *     <li> {@code id} is ignored (not mapped) </li>
     *     <li> {@code name}, {@code email}, {@code password}, and {@code admin} are mapped from the DTO to the entity,
     *          with any {@code null} values being ignored. </li>
     * </ul>
     *
     * @param dto    the {@link UserRequest} DTO containing the data to update the entity.
     * @param entity the {@link User} entity to be updated.
     */
    @Mapping(target = "id", ignore = true)
    @Mapping(target = "name", source = "name", nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)
    @Mapping(target = "email", source = "email", nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)
    @Mapping(target = "password", source = "password", nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)
    @Mapping(target = "admin", source = "admin", nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)
    void updateEntityFromDto(UserRequest dto, @MappingTarget User entity);
}
