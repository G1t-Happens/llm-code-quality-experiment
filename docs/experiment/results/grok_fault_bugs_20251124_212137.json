[
  {
    "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
    "start_line": 99,
    "end_line": 113,
    "severity": "critical",
    "error_description": "SQL injection vulnerability in getByUsername method: Raw SQL concatenation 'SELECT * FROM users WHERE username = \\'' + username + '\\'' directly injects user input without parameterization, enabling malicious SQL execution (e.g., ' OR 1=1--). This hypothesizes a nonmalicious development fault (design flaw in lines 102-103) from inadequate input sanitization, potentially leading to data breach failure (high propagation risk to unauthorized access)."
  },
  {
    "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
    "start_line": 99,
    "end_line": 113,
    "severity": "high",
    "error_description": "Inefficient and redundant user lookup in getByUsername: Method executes raw SQL instead of using JPA's findByUsername (line 13 in UserRepository), bypassing caching and optimizations. Pass 1 (performance perspective): Hypothesizes development fault (omission) causing N+1 query issues under load. Pass 2 (security re-evaluation): Reinforces SQL injection risk with unnecessary native query. Pass 3 (adversarial simulation): Attacker could exploit slow queries for DoS via crafted usernames, leading to timing failure (medium propagation to availability loss)."
  },
  {
    "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
    "start_line": 152,
    "end_line": 156,
    "severity": "high",
    "error_description": "Double password hashing in update method: Mapping expression (line 155) applies passwordEncoder.encode twice on dto.password(), resulting in incorrect hash (e.g., BCrypt of BCrypt). Pass 1 (correctness view): Hypothesizes algorithmic fault (development mistake) causing authentication errors on updates. Pass 2 (propagation paths): Latent error activates on password change, leading to lockout failure. Pass 3 (new inputs): With null password, falls back correctly but double-hash corrupts non-null updates, high risk to user integrity."
  },
  {
    "filename": "src/main/java/com/llmquality/baseline/service/AddressServiceImpl.java",
    "start_line": 67,
    "end_line": 67,
    "severity": "medium",
    "error_description": "Unsafe address retrieval without ownership check: getById uses addressRepository.findById(addressId).get() (line 67) before enforceAddressOwnership, risking LazyInitializationException if user unloaded or N+1 queries. Pass 1 (state deviation): Hypothesizes interaction fault (JPA session mismatch) causing runtime errors. Pass 2 (propagation): Error may halt service if transaction ends early. Pass 3 (adversarial): Malicious userId could trigger exceptions revealing internal state, medium risk to erratic failure."
  },
  {
    "filename": "src/main/java/com/llmquality/baseline/service/AddressServiceImpl.java",
    "start_line": 116,
    "end_line": 116,
    "severity": "medium",
    "error_description": "Inconsistent error handling in delete: Uses findById(addressId) without prior user existence check (line 116), unlike listAll/save which validate user first. Pass 1 (consistency perspective): Hypothesizes design fault leading to orphaned deletes if user missing. Pass 2 (new paths): If userId invalid but address exists (data inconsistency), throws misleading Address not found. Pass 3 (tolerance): Lowers fault tolerance; recommend unified validation, medium propagation to incorrect service delivery."
  },
  {
    "filename": "src/main/java/com/llmquality/baseline/service/AddressServiceImpl.java",
    "start_line": 79,
    "end_line": 89,
    "severity": "low",
    "error_description": "Premature mapping in save method: toAddressResponse called on unsaved entity (line 87), returning null/undefined id in response despite @Transactional. Pass 1 (state analysis): Hypothesizes dormant fault (uninitialized id) activating post-flush. Pass 2 (simulated inputs): With auto-generated IDs, response id is null until commit, causing client confusion. Pass 3 (branches): If flush fails, inconsistent state; low severity but recommend save-then-map for correct service."
  },
  {
    "filename": "src/main/java/com/llmquality/baseline/mapper/UserMapper.java",
    "start_line": 55,
    "end_line": 55,
    "severity": "high",
    "error_description": "Incorrect null handling and double-encode in update mapping: Expression (line 55) double-encodes if password non-null and incorrectly references entity.getPassword() in fallback. Pass 1 (validation view): Hypothesizes software fault (logical error) breaking partial updates. Pass 2 (propagation): Leads to invalid credentials on update, high risk to authentication failure. Pass 3 (adversarial): Attacker could force password reset via null, corrupting hashes."
  },
  {
    "filename": "src/main/java/com/llmquality/baseline/security/SecurityConfig.java",
    "start_line": 80,
    "end_line": 88,
    "severity": "medium",
    "error_description": "Misconfigured JWT authorities conversion: setAuthoritiesClaimName(\"scope\") (line 82) expects array but generateJwtToken sets string (line 242 in UserServiceImpl), potentially causing empty roles. Pass 1 (integration perspective): Hypothesizes interaction fault between service and config. Pass 2 (new conditions): Admin users get no ROLE_ADMIN, leading to unauthorized access denial. Pass 3 (adversarial): Downgrades all to USER, medium risk to privilege failure."
  },
  {
    "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
    "start_line": 181,
    "end_line": 181,
    "severity": "low",
    "error_description": "Potential null dereference in checkLogin: userRepository.findByUsername(username).get() (line 181) assumes non-null, but if DB error, throws NoSuchElementException before UnauthorizedException. Pass 1 (robustness view): Hypothesizes external fault (DB unavailability) causing unhandled exception. Pass 2 (propagation paths): Deviates from expected 401, leading to 500 failure. Pass 3 (simulated faults): Low probability but recommend orElseThrow for consistent error handling."
  }
]