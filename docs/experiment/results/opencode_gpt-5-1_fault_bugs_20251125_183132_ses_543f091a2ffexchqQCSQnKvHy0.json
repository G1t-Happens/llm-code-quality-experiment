{
  "_metadata": {
    "source_file": "session-ses_543f.md",
    "model": "gpt.5.1",
    "session_id": "ses_543f091a2ffexchqQCSQnKvHy0",
    "processed_at": "2025-11-25T18:31:32.646707",
    "bug_count": 18
  },
  "bugs": [
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 99,
      "end_line": 105,
      "severity": "high",
      "error_description": "High-probability nonmalicious development fault: getByUsername builds a native SQL string with direct username concatenation (\"SELECT * FROM users WHERE username = '\" + username + \"'\") enabling SQL injection and bypassing repository-level protections."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 118,
      "end_line": 119,
      "severity": "high",
      "error_description": "High-probability nonmalicious development fault: save() logs the raw password in DEBUG logs (\"user with name: {} and password: {}\"), causing confidentiality breach of credentials if logs are accessed."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 125,
      "end_line": 126,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious development/configuration fault: save() instantiates a local BCryptPasswordEncoder instead of using the injected PasswordEncoder bean, creating hidden coupling to BCrypt and risking broken authentication if the global encoder is changed (e.g., to Argon2)."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 151,
      "end_line": 153,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious development/configuration fault: update() instantiates a local BCryptPasswordEncoder just like save(), diverging from the SecurityConfig PasswordEncoder bean and risking inconsistent hashing behavior across the application lifecycle."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/mapper/UserMapper.java",
      "start_line": 53,
      "end_line": 56,
      "severity": "high",
      "error_description": "High-probability nonmalicious development fault: updateUserEntityFromUserRequest maps password with double encoding (passwordEncoder.encode(passwordEncoder.encode(dto.password()))), so updated passwords are double-hashed and will no longer match raw credentials during login, causing systematic authentication failures after password updates."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 161,
      "end_line": 172,
      "severity": "high",
      "error_description": "High-probability nonmalicious development fault: delete() loads the User but never calls userRepository.delete(...), yet logs \"user with id {} deleted\". This omission leaves users undeleted while reporting success, creating latent data-retention and authorization errors."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 175,
      "end_line": 189,
      "severity": "high",
      "error_description": "High-probability nonmalicious development fault: checkLogin() calls userRepository.findByUsername(username).get() without checking presence, so unknown usernames trigger NoSuchElementException and 500 Internal Server Error instead of controlled 401 Unauthorized; in addition, the subsequent null-check on user and use of DUMMY_HASH never execute, defeating the intended timing-attack mitigation."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 71,
      "end_line": 80,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious design fault: listAll(Pageable) ignores the Pageable by calling userRepository.findAll() and wrapping all results in a PageImpl, violating the CRUDable contract and causing unbounded memory usage and incorrect paging semantics for large user tables."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/AddressServiceImpl.java",
      "start_line": 65,
      "end_line": 73,
      "severity": "high",
      "error_description": "High-probability nonmalicious development fault: getById() calls addressRepository.findById(addressId).get() without presence check, so missing addresses yield NoSuchElementException and 500 Internal Server Error instead of the expected ResourceNotFoundException (404)."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/AddressServiceImpl.java",
      "start_line": 76,
      "end_line": 89,
      "severity": "high",
      "error_description": "High-probability nonmalicious development fault: save() constructs an Address entity via the mapper and immediately maps it back to AddressResponse without ever calling addressRepository.save(...), so addresses are never persisted despite logs claiming \"address saved\", leading to silent data loss."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/controller/UserController.java",
      "start_line": 47,
      "end_line": 51,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious development fault: create() lacks @Valid/@Validated(Create.class) on UserRequest, so server-side bean validation for username, password, email, and admin flags is never enforced on user creation, allowing inconsistent or invalid state to enter the system."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/controller/UserController.java",
      "start_line": 59,
      "end_line": 62,
      "severity": "high",
      "error_description": "High-probability nonmalicious security design fault: delete() defines a DELETE /users/{id} endpoint without any @PreAuthorize guard, so any authenticated principal (regardless of role or ownership) can attempt user deletion once the service-layer delete bug is fixed, violating access-control policy."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/controller/AddressController.java",
      "start_line": 44,
      "end_line": 47,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious design/interaction fault: create() is annotated with @PostMapping(consumes = \"text/plain\") but expects a structured AddressRequest body, causing typical JSON clients (sending application/json) to receive 415/400 responses and preventing normal address creation."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/exception/handler/GlobalExceptionHandler.java",
      "start_line": 47,
      "end_line": 51,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious security/diagnostic fault: handleMalformedJson() exposes ex.getMostSpecificCause().getMessage() directly in the API error message, potentially leaking internal class names, SQL fragments, or stack details to clients in malformed JSON scenarios."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/dto/AddressRequest.java",
      "start_line": 23,
      "end_line": 35,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious schema/validation design fault: AddressRequest.houseNumber and postalCode are validated with @Size(max = 255), while V1__create_tables.sql restricts these columns to VARCHAR(20); this mismatch allows inputs that pass validation but systematically fail at the database layer with DataIntegrityViolationException."
    },
    {
      "filename": "src/main/resources/db/migration/V1__create_tables.sql",
      "start_line": 16,
      "end_line": 21,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious schema design fault corresponding to DTO mismatch: addresses.house_number and addresses.postal_code are defined as VARCHAR(20) but the API DTO (AddressRequest) permits up to 255 characters, ensuring that some accepted requests will be rejected by the database and reported as generic persistence errors."
    },
    {
      "filename": "src/main/resources/application.properties",
      "start_line": 21,
      "end_line": 24,
      "severity": "medium",
      "error_description": "Medium-probability nonmalicious configuration/design fault: spring.jpa.hibernate.ddl-auto=update is enabled while Flyway migration scripts (db/migration/V1__create_tables.sql, V2__insert_data.sql) also manage schema, risking divergent schemas across environments and hard-to-diagnose data/column mismatches over time."
    },
    {
      "filename": "src/main/resources/application.properties",
      "start_line": 23,
      "end_line": 23,
      "severity": "low",
      "error_description": "Low-probability nonmalicious configuration fault: spring.jpa.show-sql=true logs all SQL statements in production-like environments, increasing risk of sensitive-data exposure (e.g., parameter values) via logs and impacting performance under load."
    }
  ]
}