{
  "_metadata": {
    "source_file": "session-ses_525d.md",
    "model": "gpt.5.1.codex",
    "session_id": "ses_525df4866ffew5x2HIVwHYzQPR",
    "processed_at": "2025-12-01T14:45:56.506167",
    "total_tokens": 69068,
    "time_taken_seconds": 473,
    "bug_count": 15
  },
  "bugs": [
    {
      "filename": "src/main/java/com/llmquality/baseline/controller/AddressController.java",
      "start_line": 44,
      "end_line": 47,
      "error_description": "The address creation endpoint declares `consumes = \"text/plain\"` while binding a JSON DTO, causing Spring to return 415/400 for valid JSON requests because no converter can turn plain text into `AddressRequest`."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/controller/AddressController.java",
      "start_line": 50,
      "end_line": 53,
      "error_description": "The PATCH endpoint accepts `AddressRequest` without `@Validated(Update.class)` (or even `@Valid`), so clients can send invalid data (blank street, malformed postal code, etc.) and it will bypass all Jakarta validation constraints."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/controller/UserController.java",
      "start_line": 47,
      "end_line": 51,
      "error_description": "User creation lacks any `@Valid/@Validated(Create.class)` on the request body, meaning passwords, emails and usernames are never validated and malformed data is persisted."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/controller/UserController.java",
      "start_line": 59,
      "end_line": 61,
      "error_description": "`@DeleteMapping` `/users/{id}` has no `@PreAuthorize`, allowing any anonymous caller to delete arbitrary users, which is a critical security vulnerability."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/AddressServiceImpl.java",
      "start_line": 65,
      "end_line": 73,
      "error_description": "`getById` calls `addressRepository.findById(addressId).get()`; when the ID does not exist it throws `NoSuchElementException` and returns 500 instead of the intended 404 `ResourceNotFoundException`."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/AddressServiceImpl.java",
      "start_line": 78,
      "end_line": 89,
      "error_description": "`save` maps the DTO to an entity and immediately maps it back to a response without ever calling `addressRepository.save`, so no address is persisted and the returned DTO always has a null id."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/mapper/UserMapper.java",
      "start_line": 53,
      "end_line": 56,
      "error_description": "`updateUserEntityFromUserRequest` encodes the password twice (`passwordEncoder.encode(passwordEncoder.encode(dto.password()))`), producing hashes that will never match during login and locking users out after an update."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 71,
      "end_line": 80,
      "error_description": "`listAll` ignores the supplied `Pageable`, loads the entire user table into memory, and wraps it in a `PageImpl`, so pagination and sorting parameters from the API are silently ignored and large datasets will exhaust memory."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 98,
      "end_line": 107,
      "error_description": "`getByUsername` builds SQL via string concatenation (`SELECT * FROM users WHERE username = '...')` and feeds it directly to `EntityManager`, allowing SQL injection if a crafted username is supplied."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 117,
      "end_line": 119,
      "error_description": "The save method logs both the username and the raw password (`\"user with name: {} and password: {}\"`), leaking credentials into log files and violating security best practices."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 161,
      "end_line": 172,
      "error_description": "`delete` loads the user but never calls `userRepository.delete(...)`, so DELETE requests report success without actually removing anything from the database."
    },
    {
      "filename": "src/main/java/com/llmquality/baseline/service/UserServiceImpl.java",
      "start_line": 175,
      "end_line": 188,
      "error_description": "`checkLogin` calls `userRepository.findByUsername(username).get()`; missing users cause `NoSuchElementException` (500) before the dummy hash logic can run, defeating the intended timing attack mitigation and skipping the proper 401 response."
    },
    {
      "filename": "src/main/resources/db/migration/V1__create_tables.sql",
      "start_line": 14,
      "end_line": 21,
      "error_description": "The database schema restricts `house_number` and `postal_code` to VARCHAR(20), but `AddressRequest` and the JPA entity allow 255 characters, so valid API requests (length >20) will fail at the database layer with data truncation errors."
    }
  ]
}